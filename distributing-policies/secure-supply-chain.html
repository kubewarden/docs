<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-distributing-policies/secure-supply-chain">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.21">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-56382716-13","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>


<link rel="search" type="application/opensearchdescription+xml" title="Kubewarden" href="/opensearch.xml"><title data-rh="true">Kubewarden</title><meta data-rh="true" property="og:title" content="Kubewarden"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.kubewarden.io/distributing-policies/secure-supply-chain"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="description" content="A Secure Supply Chain infrastructure allows software developers and users to ensure"><meta data-rh="true" property="og:description" content="A Secure Supply Chain infrastructure allows software developers and users to ensure"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.kubewarden.io/distributing-policies/secure-supply-chain"><link data-rh="true" rel="alternate" href="https://docs.kubewarden.io/distributing-policies/secure-supply-chain" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.kubewarden.io/distributing-policies/secure-supply-chain" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://HJOF663D19-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.7f04bed0.css">
<link rel="preload" href="/assets/js/runtime~main.1ebc047b.js" as="script">
<link rel="preload" href="/assets/js/main.049cf7e1.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/icon-kubewarden.svg" alt="logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/icon-kubewarden.svg" alt="logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Kubewarden, a CNCF Sandbox Project</b></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__docs navbar__link--active" href="/">Docs</a><a href="https://github.com/kubewarden/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar__github btn btn-secondary icon-github">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/quick-start">Quick Start</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/tasks">Common Tasks</a><button aria-label="Toggle the collapsible sidebar category &#x27;Common Tasks&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/architecture">Architecture</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/writing-policies">Writing Policies</a><button aria-label="Toggle the collapsible sidebar category &#x27;Writing Policies&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/distributing-policies">Distributing Policies</a><button aria-label="Toggle the collapsible sidebar category &#x27;Distributing Policies&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/distributing-policies/custom-certificate-authorities">Custom Certificate Authorities</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/distributing-policies/oci-registries-support">OCI Registries Support</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/distributing-policies/secure-supply-chain">Secure Supply Chain</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/testing-policies/intro">Testing Policies</a><button aria-label="Toggle the collapsible sidebar category &#x27;Testing Policies&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/operator-manual/intro">Operator Manual</a><button aria-label="Toggle the collapsible sidebar category &#x27;Operator Manual&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/security/intro">Security</a><button aria-label="Toggle the collapsible sidebar category &#x27;Security&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_GujU"><div class="docItemContainer_Adtb"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/distributing-policies"><span itemprop="name">Distributing Policies</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Secure Supply Chain</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_aoJ5"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Secure Supply Chain</h1><p>A Secure Supply Chain infrastructure allows software developers and users to ensure
the validity of the artefacts&#x27; chain of custody, thus mitigating
security issues in their environments. The goal of the <a href="https://sigstore.dev/" target="_blank" rel="noopener noreferrer">Sigstore project</a>
is to provide the tools and infrastructure for validating the integrity of the supply chain.
Kubewarden leverages the <a href="https://github.com/sigstore/cosign" target="_blank" rel="noopener noreferrer"><code>cosign</code></a> utility together
with the <a href="https://github.com/SigStore/fulcio" target="_blank" rel="noopener noreferrer">fulcio</a> and <a href="https://github.com/sigstore/rekor" target="_blank" rel="noopener noreferrer">rekor</a>
infrastructure offered by the Sigstore project to bring these security measures to its users.</p><p>Therefore, cluster operators can configure Kubewarden to only run policies signed
by entities that they trust while policy developers can sign their policies and
publish them in a registry.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a class="hash-link" href="#prerequisites" title="Direct link to heading">​</a></h2><p>In the following sections, we will need a few tools to be installed so that
users can sign and verify OCI artefacts signatures. For key-based signing, the examples demonstrate
the use of <a href="https://docs.sigstore.dev/cosign/installation/" target="_blank" rel="noopener noreferrer"><code>cosign</code></a> and <a href="https://github.com/kubewarden/kwctl" target="_blank" rel="noopener noreferrer"><code>kwctl</code></a> utilities for signing and inspecting policies.</p><p>Users may also want to leverage GitHub to sign their policies. In which case, they can choose to install and use
<a href="https://docs.sigstore.dev/cosign/installation/#github-action" target="_blank" rel="noopener noreferrer">Github actions</a></p><p>Keyless signing has been demonstrated using the default <a href="https://github.com/SigStore/fulcio" target="_blank" rel="noopener noreferrer">fulcio</a>
and <a href="https://github.com/sigstore/rekor" target="_blank" rel="noopener noreferrer">rekor</a> instances provided by the
Sigstore project. Users may choose to utilise their own
infrastructure by checking the Sigstore project documentation for more details.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="signing-policies">Signing policies<a class="hash-link" href="#signing-policies" title="Direct link to heading">​</a></h2><p>Kubewarden recommends using Sigstore&#x27;s <a href="https://github.com/sigstore/cosign" target="_blank" rel="noopener noreferrer">cosign</a> utility
for signing policies. This subsection details a key-based method of signing policies
in which, users need to generate a private-public key pair. The generated keys help
in verifying whether the signed artefacts came from the expected user i.e. the
owner of the keys. Using the <code>cosign generate-key-pair</code> command, as illustrated
below, it is possible to generate the aforementioned keypair.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cosign generate-key-pair</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Enter password </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> private key:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Enter password </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> private key again:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Private key written to cosign.key</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Public key written to cosign.pub</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Once the keys are generated, users can use it to sign policies.</p><blockquote><p><strong>WARNING</strong>: The private key file, <code>cosign.key</code>, should not be shared. This
is a secret file that should be used only by the owner of the key for signing policies.</p></blockquote><p>To sign a policy users can execute the <code>cosign sign</code> command passing the <code>--key</code>
command line argument with their private key file:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cosign sign --key cosign.key ghcr.io/jvanz/policies/user-group-psp:latest</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">an error occurred: no provider found </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> that key reference, will try to load key from disk</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Enter password </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> private key:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Pushing signature to: ghcr.io/jvanz/policies/user-group-psp</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This command will sign the policy by creating a new signature object. The signature
object is then uploaded into the registry, next to the policy. Now the policy is ready to be used
in a Kubewarden installation with signature verification enabled.</p><p>The same policy can be signed multiple times, either by the same user or by different ones. All these signatures are appended to the same signature object.</p><blockquote><p><strong>NOTE</strong>: For more information about how the signing process works under the hood, check
out the <a href="https://docs.sigstore.dev/" target="_blank" rel="noopener noreferrer">Sigstore project documentation</a></p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="keyless-signing">Keyless signing<a class="hash-link" href="#keyless-signing" title="Direct link to heading">​</a></h3><p>Many times the policies are automatically built in CI/CD pipelines which complicates
the key generation process. The Sigstore keyless workflow described below is specifically designed for
these situations and others where key generation is not possible.
Instead of using long-lived singing keys, the keyless workflow uses certificate authorities (CAs) and
certificate chains. A short-lived certificate key is generated, and linked into
a chain of trust by completing an identity challenge to confirm the signer&#x27;s
identity. The life of the certificate key is just about enough for the signing
to occur. The identity challenge is performed by authenticating against an
OpenID Connect (OIDC) provider. Sigstore&#x27;s Fulcio public infrastructure is used for the chain of trust.</p><p>For signing, we will again use Sigstore&#x27;s cosign utility. However, as of this
writing, this feature is not enabled by default in cosign. So, it&#x27;s necessary
to enable this experimental feature before proceeding with keyless signing as shown below:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ COSIGN_EXPERIMENTAL=1 cosign sign ghcr.io/jvanz/policies/user-group-psp:latest</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Generating ephemeral keys...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Retrieving signed certificate...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Your browser will now be opened to:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">https://oauth2.sigstore.dev/auth/auth?access_type=online&amp;client_id=sigstore&amp;code_challenge=&lt;REDACTED&gt;&amp;code_challenge_method=S256&amp;nonce=&lt;REDACTED&gt;&amp;redirect_uri=http%3A%2F%2Flocalhost%3A34021%2Fauth%2Fcallback&amp;response_type=code&amp;scope=openid+email&amp;state=&lt;REDACTED&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">client.go:196: root pinning is not supported in Spec 1.0.19</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Successfully verified SCT...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">tlog entry created with index: 1819248</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Pushing signature to: ghcr.io/jvanz/policies/user-group-psp</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>With that, the policy has been signed and pushed to the repository. Note that there are no keys generated as a byproduct.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-sign-artefacts-in-github-workflows">How to sign artefacts in GitHub workflows<a class="hash-link" href="#how-to-sign-artefacts-in-github-workflows" title="Direct link to heading">​</a></h3><p><code>cosign</code> does not require the user to log on to an OIDC provider when using keyless signing
in the context of a GitHub action environment. In this scenario,
the GitHub token available during the execution of the workflow will be used to
authenticate the user and generate the ephemeral keys. The signing process is
the same used in the <code>Keyless</code> mode. This is an example of how Kubewarden project
signs its policies:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># ... beginning of the workflow file ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">jobs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">build</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Build container image</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">runs-on</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> ubuntu</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">steps</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># ... other steps building the container image ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Login to GitHub Container Registry</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">uses</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> docker/login</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">action@v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">with</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">registry</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> ghcr.io</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">username</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> github.repository_owner </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">password</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> inputs.GITHUB_TOKEN </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Publish Wasm policy artifact to OCI registry with the &#x27;latest&#x27; tag</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">shell</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> bash</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> startsWith(github.ref</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> &#x27;refs/heads/&#x27;) </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">env</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">COSIGN_EXPERIMENTAL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">run</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">|</span><span class="token scalar string" style="color:rgb(195, 232, 141)"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">        set -ex</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">        echo Pushing policy to OCI container registry</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">        IMMUTABLE_REF=$(kwctl push -o json ${{ PATH_TO_BUILT_WASM_FILE }} ghcr.io/myorg/policies/my-great-policy:latest | jq -r .immutable_ref)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">        echo Keyless signing of policy using cosign</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">        cosign sign ${IMMUTABLE_REF}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># ... other build steps ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># ... remaining of the workflow file ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p><strong>NOTE</strong>: The policy templates repositories provided by the Kubewarden team
already have Github actions to build, test, sign and publish policies. It&#x27;s
highly recommended that policy developers use those templates.</p></blockquote><p>In the example above, we demonstrate using <code>kwctl</code> to publish the container image and find
the reference to it. This is not mandatory. You can call <code>cosign</code> with the image
reference generated elsewhere.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="listing-policy-signatures">Listing policy signatures<a class="hash-link" href="#listing-policy-signatures" title="Direct link to heading">​</a></h2><p><code>kwctl</code> also allows users to check the signatures in a published
policy. The <code>kwctl inspect</code> command shows all the relevant information about the
policy and its signatures as illustrated in an example below:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kwctl inspect registry://ghcr.io/kubewarden/policies/user-group-psp:v0.2.0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Details</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">title:              psp-user-group</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">description:        Short description</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">author:             José Guilherme Vanz &lt;jguilhermevanz@suse.com&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">url:                https://github.com/kubewarden/user-group-psp-policy</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">source:             https://github.com/kubewarden/user-group-psp-policy</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">license:            Apache-2.0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">mutating:           true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">context aware:      false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">execution mode:     kubewarden-wapc</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">protocol version:   1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Annotations</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">io.kubewarden.kwctl 0.2.5-rc2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Rules</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">────────────────────</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">---</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">- apiGroups:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    - &quot;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  apiVersions:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    - v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  resources:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    - pods</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  operations:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    - CREATE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">────────────────────</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Usage</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">This policy enforce the user and group used in the container.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Sigstore signatures</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Digest:                            sha256:026af67682a85d424e7d95db460171635f5c3957d67b53499bece912cc0413cc</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Media type:                        application/vnd.dev.cosign.simplesigning.v1+json</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Size:                              258</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Annotations</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">dev.sigstore.cosign/certificate    -----BEGIN CERTIFICATE-----</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                   MIIDRzCCAsygAwIBAgITbPUZlUFkkAHtbzc3rzC/3zXj1DAKBggqhkjOPQQDAzAq</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                   MRUwEwYDVQQKEwxzaWdzdG9yZS5kZXYxETAPBgNVBAMTCHNpZ3N0b3JlMB4XDTIy</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                   MDIyNTE2MzAwMloXDTIyMDIyNTE2NDAwMVowEzERMA8GA1UEChMIc2lnc3RvcmUw</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                   WTATBgcqhkjOPQIBBggqhkjOPQMBBwNCAAR/O5c6ZI5BzBweoEIam4uWu5fqzHx0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                   3PTCgfXyyvIjorz9wX08bsndkHdWfFObU+PztbxX78An43Yw9/fHtO93o4IB5jCC</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                   AeIwDgYDVR0PAQH/BAQDAgeAMBMGA1UdJQQMMAoGCCsGAQUFBwMDMAwGA1UdEwEB</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                   /wQCMAAwHQYDVR0OBBYEFCP/v7NEJQglbDmyC5VMgnvhiuBUMB8GA1UdIwQYMBaA</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                   FFjAHl+RRaVmqXrMkKGTItAqxcX6MHgGA1UdEQRxMG+GbWh0dHBzOi8vZ2l0aHVi</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                   LmNvbS9rdWJld2FyZGVuL2dpdGh1Yi1hY3Rpb25zLy5naXRodWIvd29ya2Zsb3dz</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                   L3JldXNhYmxlLXJlbGVhc2UtcG9saWN5LXJ1c3QueW1sQHJlZnMvaGVhZHMvdjEw</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                   NgYKKwYBBAGDvzABAwQoMmJiMGQ4NjZjMzFmOGMyZTQ3NDMxMDI4M2ExNmFkMWFi</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                   NjBlZjA1YjAuBgorBgEEAYO/MAEFBCBrdWJld2FyZGVuL3VzZXItZ3JvdXAtcHNw</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                   LXBvbGljeTAcBgorBgEEAYO/MAEEBA5SZWxlYXNlIHBvbGljeTASBgorBgEEAYO/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                   MAECBARwdXNoMDkGCisGAQQBg78wAQEEK2h0dHBzOi8vdG9rZW4uYWN0aW9ucy5n</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                   aXRodWJ1c2VyY29udGVudC5jb20wHgYKKwYBBAGDvzABBgQQcmVmcy90YWdzL3Yw</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                   LjIuMDAKBggqhkjOPQQDAwNpADBmAjEAyGQbNCkOifStO7yCCfF8yXyc144ANn2x</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                   Ty92WYC0pTaVhviOED47fgD6TncKf+92AjEAjBfjLmCG/Mwrh8t+gfHJEAWWEc9Q</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                   +j9NR4wF66uABS/TTh5CYlrnIuqSD+GBHGwV</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                   -----END CERTIFICATE-----</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">dev.sigstore.cosign/timestamp      {&quot;signatures&quot;:[{&quot;keyid&quot;:&quot;b6710623a30c010738e64c5209d367df1c0a18cf90e6ab5292fb01680f83453d&quot;,&quot;sig&quot;:&quot;3046022100f666a7f4b3d85d8003f2c166e27827dfa0c4ab9282e9dab19485f4e702c61700022100dfe826e0edab5f80a40f08cc87b87777a4db30775d85684fe4950e797f2f565c&quot;}],&quot;signed&quot;:{&quot;_type&quot;:&quot;timestamp&quot;,&quot;spec_version&quot;:&quot;1.0&quot;,&quot;version&quot;:15,&quot;expires&quot;:&quot;2022-03-08T19:14:05Z&quot;,&quot;meta&quot;:{&quot;snapshot.json&quot;:{&quot;length&quot;:1655,&quot;hashes&quot;:{&quot;sha256&quot;:&quot;36cf063d0717f6dc03e23027721adcd69b684d293956d3a1a7db7b0848f711d7&quot;,&quot;sha512&quot;:&quot;f90946d0a2dc58dae4505cfb91517a40299adf9e8719f52af187e2025aad69fcdeaeded271ec25db24869841c16fbe24f3fc56f56af8fdbb8808dccec4636b64&quot;},&quot;version&quot;:15}}}}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">dev.sigstore.cosign/bundle         {&quot;SignedEntryTimestamp&quot;:&quot;MEUCIEfu4qR+HsexSDk5h2QXMduvoRCX10J+4CLQWtYw5VD6AiEAyYCEjvJdv2Sr5tZ4LApnddH/4v+CoV1QkuvbCQ3iIUM=&quot;,&quot;Payload&quot;:{&quot;body&quot;:&quot;eyJhcGlWZXJzaW9uIjoiMC4wLjEiLCJraW5kIjoiaGFzaGVkcmVrb3JkIiwic3BlYyI6eyJkYXRhIjp7Imhhc2giOnsiYWxnb3JpdGhtIjoic2hhMjU2IiwidmFsdWUiOiIwMjZhZjY3NjgyYTg1ZDQyNGU3ZDk1ZGI0NjAxNzE2MzVmNWMzOTU3ZDY3YjUzNDk5YmVjZTkxMmNjMDQxM2NjIn19LCJzaWduYXR1cmUiOnsiY29udGVudCI6Ik1FWUNJUUNXNWZRZ1BUUTdaTlNuRkhzbHJOTlFrS2dTSVFpOGNSMTU5UEExc0s4VGlRSWhBSndMOWJPcUJKbVduN1lLZG9Tem80c2xPZ2s4SkJCanFYZHNydDNyeVF0QiIsInB1YmxpY0tleSI6eyJjb250ZW50IjoiTFMwdExTMUNSVWRKVGlCRFJWSlVTVVpKUTBGVVJTMHRMUzB0Q2sxSlNVUlNla05EUVhONVowRjNTVUpCWjBsVVlsQlZXbXhWUm10clFVaDBZbnBqTTNKNlF5OHplbGhxTVVSQlMwSm5aM0ZvYTJwUFVGRlJSRUY2UVhFS1RWSlZkMFYzV1VSV1VWRkxSWGQ0ZW1GWFpIcGtSemw1V2xNMWExcFlXWGhGVkVGUVFtZE9Wa0pCVFZSRFNFNXdXak5PTUdJelNteE5RalJZUkZSSmVRcE5SRWw1VGxSRk1rMTZRWGROYkc5WVJGUkplVTFFU1hsT1ZFVXlUa1JCZDAxV2IzZEZla1ZTVFVFNFIwRXhWVVZEYUUxSll6SnNibU16VW5aamJWVjNDbGRVUVZSQ1oyTnhhR3RxVDFCUlNVSkNaMmR4YUd0cVQxQlJUVUpDZDA1RFFVRlNMMDgxWXpaYVNUVkNla0ozWlc5RlNXRnROSFZYZFRWbWNYcEllREFLTTFCVVEyZG1XSGw1ZGtscWIzSjZPWGRZTURoaWMyNWthMGhrVjJaR1QySlZLMUI2ZEdKNFdEYzRRVzQwTTFsM09TOW1TSFJQT1ROdk5FbENOV3BEUXdwQlpVbDNSR2RaUkZaU01GQkJVVWd2UWtGUlJFRm5aVUZOUWsxSFFURlZaRXBSVVUxTlFXOUhRME56UjBGUlZVWkNkMDFFVFVGM1IwRXhWV1JGZDBWQ0NpOTNVVU5OUVVGM1NGRlpSRlpTTUU5Q1FsbEZSa05RTDNZM1RrVktVV2RzWWtSdGVVTTFWazFuYm5ab2FYVkNWVTFDT0VkQk1WVmtTWGRSV1UxQ1lVRUtSa1pxUVVoc0sxSlNZVlp0Y1ZoeVRXdExSMVJKZEVGeGVHTllOazFJWjBkQk1WVmtSVkZTZUUxSEswZGlWMmd3WkVoQ2VrOXBPSFphTW13d1lVaFdhUXBNYlU1MllsTTVjbVJYU214a01rWjVXa2RXZFV3eVpIQmtSMmd4V1dreGFGa3pVbkJpTWpWNlRIazFibUZZVW05a1YwbDJaREk1ZVdFeVduTmlNMlI2Q2t3elNteGtXRTVvV1cxNGJFeFlTbXhpUjFab1l6SlZkR05IT1hOaFYwNDFURmhLTVdNelVYVmxWekZ6VVVoS2JGcHVUWFpoUjFab1draE5kbVJxUlhjS1RtZFpTMHQzV1VKQ1FVZEVkbnBCUWtGM1VXOU5iVXBwVFVkUk5FNXFXbXBOZWtadFQwZE5lVnBVVVROT1JFMTRUVVJKTkUweVJYaE9iVVpyVFZkR2FRcE9ha0pzV21wQk1WbHFRWFZDWjI5eVFtZEZSVUZaVHk5TlFVVkdRa05DY21SWFNteGtNa1o1V2tkV2RVd3pWbnBhV0VsMFdqTktkbVJZUVhSalNFNTNDa3hZUW5aaVIyeHFaVlJCWTBKbmIzSkNaMFZGUVZsUEwwMUJSVVZDUVRWVFdsZDRiRmxZVG14SlNFSjJZa2RzYW1WVVFWTkNaMjl5UW1kRlJVRlpUeThLVFVGRlEwSkJVbmRrV0U1dlRVUnJSME5wYzBkQlVWRkNaemM0ZDBGUlJVVkxNbWd3WkVoQ2VrOXBPSFprUnpseVdsYzBkVmxYVGpCaFZ6bDFZM2sxYmdwaFdGSnZaRmRLTVdNeVZubFpNamwxWkVkV2RXUkROV3BpTWpCM1NHZFpTMHQzV1VKQ1FVZEVkbnBCUWtKblVWRmpiVlp0WTNrNU1GbFhaSHBNTTFsM0NreHFTWFZOUkVGTFFtZG5jV2hyYWs5UVVWRkVRWGRPY0VGRVFtMUJha1ZCZVVkUllrNURhMDlwWmxOMFR6ZDVRME5tUmpoNVdIbGpNVFEwUVU1dU1uZ0tWSGs1TWxkWlF6QndWR0ZXYUhacFQwVkVORGRtWjBRMlZHNWpTMllyT1RKQmFrVkJha0ptYWt4dFEwY3ZUWGR5YURoMEsyZG1TRXBGUVZkWFJXTTVVUW9yYWpsT1VqUjNSalkyZFVGQ1V5OVVWR2cxUTFsc2NtNUpkWEZUUkN0SFFraEhkMVlLTFMwdExTMUZUa1FnUTBWU1ZFbEdTVU5CVkVVdExTMHRMUW89In19fX0=&quot;,&quot;integratedTime&quot;:1645806604,&quot;logIndex&quot;:1506651,&quot;logID&quot;:&quot;c0d23d6ad406973f9559f3ba2d1ca01f84147d8ffc5b8445c224f98b9591801d&quot;}}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">dev.sigstore.cosign/chain          -----BEGIN CERTIFICATE-----</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                   MIIB9zCCAXygAwIBAgIUALZNAPFdxHPwjeDloDwyYChAO/4wCgYIKoZIzj0EAwMw</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                   KjEVMBMGA1UEChMMc2lnc3RvcmUuZGV2MREwDwYDVQQDEwhzaWdzdG9yZTAeFw0y</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                   MTEwMDcxMzU2NTlaFw0zMTEwMDUxMzU2NThaMCoxFTATBgNVBAoTDHNpZ3N0b3Jl</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                   LmRldjERMA8GA1UEAxMIc2lnc3RvcmUwdjAQBgcqhkjOPQIBBgUrgQQAIgNiAAT7</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                   XeFT4rb3PQGwS4IajtLk3/OlnpgangaBclYpsYBr5i+4ynB07ceb3LP0OIOZdxex</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                   X69c5iVuyJRQ+Hz05yi+UF3uBWAlHpiS5sh0+H2GHE7SXrk1EC5m1Tr19L9gg92j</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                   YzBhMA4GA1UdDwEB/wQEAwIBBjAPBgNVHRMBAf8EBTADAQH/MB0GA1UdDgQWBBRY</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                   wB5fkUWlZql6zJChkyLQKsXF+jAfBgNVHSMEGDAWgBRYwB5fkUWlZql6zJChkyLQ</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                   KsXF+jAKBggqhkjOPQQDAwNpADBmAjEAj1nHeXZp+13NWBNa+EDsDP8G1WWg1tCM</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                   WP/WHPqpaVo0jhsweNFZgSs0eE7wYI4qAjEA2WB9ot98sIkoF3vZYdd3/VtWB5b9</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                   TNMea7Ix/stJ5TfcLLeABLE4BNJOsQ4vnBHJ</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                   -----END CERTIFICATE-----</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">dev.cosignproject.cosign/signature MEYCIQCW5fQgPTQ7ZNSnFHslrNNQkKgSIQi8cR159PA1sK8TiQIhAJwL9bOqBJmWn7YKdoSzo4slOgk8JBBjqXdsrt3ryQtB</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="verifying-policies">Verifying policies<a class="hash-link" href="#verifying-policies" title="Direct link to heading">​</a></h2><p>Users can check if a policy is properly signed with  <code>cosign</code> or <code>kwctl</code>.
Both have similar command line flags which allow users to check the policy
signatures. To check if the binary is signed with a key, the users can use <code>kwctl</code>
like this:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kwctl verify -k cosign.pub ghcr.io/jvanz/policies/user-group-psp:latest</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">2022-03-29T14:49:31.878180Z  INFO kwctl::verify: Policy successfully verified</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Or <code>cosign</code> :</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ cosign verify --key cosign.pub ghcr.io/jvanz/policies/user-group-psp:latest</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Verification for ghcr.io/jvanz/policies/user-group-psp:latest --</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">The following checks were performed on each of these signatures:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - The cosign claims were validated</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - The signatures were verified against the specified public key</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - Any certificates were verified against the Fulcio roots.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[{&quot;critical&quot;:{&quot;identity&quot;:{&quot;docker-reference&quot;:&quot;ghcr.io/jvanz/policies/user-group-psp&quot;},&quot;image&quot;:{&quot;docker-manifest-digest&quot;:&quot;sha256:af520a8ccee03811d426c48634b7007f1220c121cc23e14962bb64510585ce97&quot;},&quot;type&quot;:&quot;cosign container image signature&quot;},&quot;optional&quot;:null}]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="configuring-the-policy-server-to-check-policy-signatures">Configuring the policy server to check policy signatures<a class="hash-link" href="#configuring-the-policy-server-to-check-policy-signatures" title="Direct link to heading">​</a></h2><p>To configure Kubewarden to run only trusted policies, the users must create
a <code>ConfigMap</code> with the minimum signature requirements needed for policies to be
executed in the environment. The <code>ConfigMap</code> follows the same structure of the
file described in the <a href="#signature-config-reference">Signature Config Reference</a> section used to verify policy
in the <code>kwctl</code> utility. The only difference in this case would be that the
<code>ConfigMap</code> should define all the configurations under the <code>verification-config</code>
field.  For example, let&#x27;s consider that the users want to run policies signed
by the Kubewarden GitHub organization. A sample <code>ConfigMap</code> for this scenario would be:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ cat kubewarden_signatures.yaml</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">allOf:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - kind: githubAction</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    owner: kubewarden</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># note that the data is stored under verification-config field</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl  create configmap my-signatures-configuration --from-file=verification-config=kubewarden_signatures.yaml</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl get configmap -o yaml my-signatures-configuration</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">data:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  verification-config: |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    apiVersion: v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    allOf:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - kind: githubAction</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        owner: kubewarden</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kind: ConfigMap</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  creationTimestamp: &quot;2022-03-29T18:27:20Z&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name: my-signatures-configuration</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  namespace: default</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  resourceVersion: &quot;10279&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  uid: d53e1c56-1fee-45de-92f5-9bd73b8cead4</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>It is also possible to use the <code>kwctl scaffold verification-config</code> to generate
a default verification config file to be used in the <code>ConfigMap</code>:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kwctl scaffold verification-config &gt; verification_config.yaml</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ cat verification_config.yaml</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Default Kubewarden verification config</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># With this config, the only valid policies are those signed by Kubewarden</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># infrastructure.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># This config can be saved to its default location (for this OS) with:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#   kwctl scaffold verification-config &gt; /home/jvanz/.config/kubewarden/verification-config.yml</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Providing a config in the default location enables Sigstore verification.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># See https://docs.kubewarden.io for more Sigstore verification options.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">---</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">allOf:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - kind: githubAction</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    owner: kubewarden</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    repo: ~</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    annotations: ~</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">anyOf: ~</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl create configmap my-signatures-configuration --from-file=verification-config=verification_config.yaml</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">configmap/my-signatures-configuration created</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl get configmap -o yaml my-signatures-configuration</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">data:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  verification-config: |+</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    # Default Kubewarden verification config</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    # With this config, the only valid policies are those signed by Kubewarden</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    # infrastructure.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    # This config can be saved to its default location (for this OS) with:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #   kwctl scaffold verification-config &gt; /home/jvanz/.config/kubewarden/verification-config.yml</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    # Providing a config in the default location enables Sigstore verification.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    # See https://docs.kubewarden.io for more Sigstore verification options.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ---</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    apiVersion: v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    allOf:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - kind: githubAction</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        owner: kubewarden</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        repo: ~</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        annotations: ~</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    anyOf: ~</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kind: ConfigMap</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  creationTimestamp: &quot;2022-04-07T11:54:27Z&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name: my-signatures-configuration</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  namespace: default</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  resourceVersion: &quot;1317&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  uid: 74dec846-7fcd-4b4b-8184-700c816f685a</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>After creating the <code>ConfigMap</code> to store the signature requirements, the users
can configure a Policy Server to start validating policy signatures by setting the
<code>ConfigMap</code> name in the field <code>verificationConfig</code>.</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> policies.kubewarden.io/v1alpha2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> PolicyServer</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">finalizers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> kubewarden</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> ghcr.io/kubewarden/policy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">server</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">v0.2.7</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">serviceAccountName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> policy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">server</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">replicas</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">verificationConfig</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> your_configmap   </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#name of the confimap with the signatures requirements</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">env</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> KUBEWARDEN_ENABLE_METRICS</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> KUBEWARDEN_LOG_FMT</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> otlp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;KUBEWARDEN_LOG_LEVEL&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;info&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If you deploy the default Policy Server using the <code>kubewarden-defaults</code>
Helm chart, you can configure this field by setting the <code>ConfigMap</code> name in the
<code>policyServer.verificationConfig</code> value.</p><p>Now, the PolicyServer will reject untrusted AdmissionPolicies and ClusterAdmissionPolicies,
by refusing to start. The user must remove the untrusted policy or fix the
signatures requirements in order to get the PolicyServer running again.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="signature-config-reference">Signature Config Reference<a class="hash-link" href="#signature-config-reference" title="Direct link to heading">​</a></h2><p>Users can also provide a file with all the signature requirements they want to validate. A sample file is shown below:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">allOf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> githubAction</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">owner</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> kubewarden   </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># mandatory</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">annotations</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">env</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> prod</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">anyOf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># at least `anyOf.minimumMatches` are required to match</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">minimumMatches</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># default is 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">signatures</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> pubKey</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">owner</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> flavio </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># optional</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">...</span><span class="token plain">. </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># mandatory</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">annotations</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># optional</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">env</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> prod</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> bar</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> pubKey</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">owner</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> victor </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># optional</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">...</span><span class="token plain">. </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># mandatory</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> genericIssuer</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">issuer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">//github.com/login/oauth</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">subject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">equal</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> alice@example.com</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> genericIssuer</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">issuer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">//token.actions.githubusercontent.com</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">subject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">equal</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">//github.com/flavio/policy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">secure</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">pod</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">images/.github/workflows/release.yml@refs/heads/main</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> genericIssuer</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">issuer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">//token.actions.githubusercontent.com</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">subject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">urlPrefix</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">//github.com/flavio/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> genericIssuer</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">issuer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">//token.actions.githubusercontent.com</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">subject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">urlPrefix</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">//github.com/kubewarden </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># &lt;- it will be post-fixed with `/` for security reasons</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> githubAction</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">owner</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> flavio   </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># mandatory</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">repo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> policy1 </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># optional</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> pubKey</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">owner</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> alice </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># optional</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">...</span><span class="token plain">. </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># mandatory</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The configuration is composed of two sections:</p><ul><li><code>anyOf</code>:  The policy will be trusted if the <code>minimumMatches</code> criterion is fulfilled.
In the above example, the <code>minimumMatches</code> field has been assigned a value 2.
This means that at least two of the signature requirements listed <strong>need to be fulfilled</strong>
for the policy to be trusted. The default value that the <code>minimumMatches</code> field assumes is <code>1</code>.</li><li><code>allOf</code>: All the signature requirements defined in this section must be valid
so that the policy can be trusted.</li></ul><p>Each of these sections can contain one or more signature requirements.
Users can also define both sections in one file as shown above. In this situations, all
the signatures requirements from the <code>allOf</code> <strong>AND</strong> a minimum number of matches
from the <code>anyOf</code> section as described in the <code>minimumMatches</code> field must be satisfied.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="signature-validation">Signature validation<a class="hash-link" href="#signature-validation" title="Direct link to heading">​</a></h3><p>The users can validate different signatures in the <code>anyOf</code> and <code>allOf</code> sections.
It&#x27;s possible to validate the public key and the keyless data used to sign the policy.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="public-key-validation">Public key validation<a class="hash-link" href="#public-key-validation" title="Direct link to heading">​</a></h4><p>To ensure a policy is signed with the given public key, the users can
define the key data and the owner of the key used to sign the policy. As illustrated
bellow, it is necessary to define the kind as <code>pubKey</code> and insert the public
key data in the <code>key</code> field. The owner field is optional, but can be useful to clarify who owns the key.</p><p><strong>Example</strong></p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> pubKey</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">owner</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> bob </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># optional</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">|</span><span class="token scalar string" style="color:rgb(195, 232, 141)"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">      -----BEGIN PUBLIC KEY-----</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">      MBFKHFDGHKIJH0CAQYIKoZIzj0DAQcDQgAEX0HFTtCfTtPmkx5p1RbDE6HJSGAVD</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">      BVDF6SKFSF87AASUspkQsN3FO4iyWodCy5j3o0CdIJD/KJHDJFHDFIu6sA==</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">      -----END PUBLIC KEY-----</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="keyless-signatures-validation">Keyless signatures validation<a class="hash-link" href="#keyless-signatures-validation" title="Direct link to heading">​</a></h4><p>When signed in keyless mode, we do not have the public key to verify. In this
situation, the users can verify the field filled with the OIDC data used during
the signing process. For that, it&#x27;s necessary to define the kind of the signature
validation as <code>genericIssuer</code>. Therefore, it&#x27;s possible to verify three pieces
of information from the signature:</p><ul><li><code>issuer</code>(mandatory): matches the <code>Issuer</code> attribute in the certificate
generated by Fulcio. This shows the OIDC used to sign the policy</li><li><code>subject</code>: field used to match the <code>Subject</code> attribute in Fulcio&#x27;s
certificate. The <code>Subject</code> field contains the information of the user used to
authenticate again the OIDC provider. The verification field, <code>subject</code>, can have
two children fields: <code>equal</code> forces the <code>Subject</code> from the certificate to be
equal to the value defined in the signature validation; <code>urlPrefix</code> forces the
value of the certificate&#x27;s <code>Subject</code> field value to be prefixed by the value
defined in the signature requirement.</li></ul><blockquote><p>Note well: both the <code>cosign verify</code> and the <code>kwctl inspect</code> commands can be used to show the information about keyless signatures.
<strong>Examples</strong></p></blockquote><p>The following configuration requires the policy to be signed by Alice in a keyless manner
using the GitHub OIDC:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> genericIssuer</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">issuer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">//github.com/login/oauth</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">subject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">equal</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> alice@example.com</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>While the next configuration enforces the policy to be signed in the context of a GitHub actions environment
from a repository owned by the GitHub user <code>flavio</code>:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> genericIssuer</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">issuer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">//token.actions.githubusercontent.com</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">subject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">urlPrefix</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">//github.com/flavio</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="github-actions-signature-verification">GitHub actions signature verification<a class="hash-link" href="#github-actions-signature-verification" title="Direct link to heading">​</a></h4><p>The signature validation kind, <code>githubAction</code> is used to validate policies signed in a GitHub
Actions environment. It can be achieved with the <code>genericIssuer</code> kind as well. But
<code>githubAction</code>simplifies the signature requirement creation process by defining two additional fields:</p><ul><li><code>owner</code> (mandatory): GitHub ID of the user or organization to be trusted</li><li><code>repo</code>: the name of the repository to be trusted</li></ul><p>For example, the last configuration snippet shown above that leveraged a <code>genericIssuer</code>, could be rewritten in this way:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> githubAction</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">owner</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> flavio</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="signature-annotations-validation">Signature annotations validation<a class="hash-link" href="#signature-annotations-validation" title="Direct link to heading">​</a></h4><p>All the signature types can have one additional optional validation field, <code>annotations</code>.
These fields are key/value data added by the users during the signing process. Kubewarden
makes possible to ensure that policies are signed by trusted users <strong>and</strong> have specific annotations.</p><p><strong>Examples</strong></p><p>If the users want to trust only policies which have been signed with a specific key
and the annotation <code>environment</code> with the value <code>production</code>, they can define the
following validation:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> pubKey</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">|</span><span class="token scalar string" style="color:rgb(195, 232, 141)"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">    -----BEGIN PUBLIC KEY-----</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">    MBFKHFDGHKIJH0CAQYIKoZIzj0DAQcDQgAEX0HFTtCfTtPmkx5p1RbDE6HJSGAVD</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">    BVDF6SKFSF87AASUspkQsN3FO4iyWodCy5j3o0CdIJD/KJHDJFHDFIu6sA==</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token scalar string" style="color:rgb(195, 232, 141)">    -----END PUBLIC KEY-----</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">annotation</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">environment</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> production</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-use-signature-verification-config-file-to-check-a-policy-oci-artefact">How to use signature verification config file to check a policy OCI artefact<a class="hash-link" href="#how-to-use-signature-verification-config-file-to-check-a-policy-oci-artefact" title="Direct link to heading">​</a></h3><p>To test if a given policy passes signature verification using the
verification config file, use the <code>--verification-config-path</code>  flag of the <code>kwctl verify</code> command</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ cat signatures_requirements.yaml</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">allOf:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - kind: pubKey</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    key: |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      -----BEGIN PUBLIC KEY-----</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAE5Q+cN1Jj2S7N05J4AXnqwP2DyzSg</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      Mc+raYce2Wthrd30MSgFtoh5ADAkCd/nML2Nx8UD9KBuASRb0gG5jXqgMQ==</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      -----END PUBLIC KEY-----</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kwctl verify --verification-config-path signatures_requirements.yaml ghcr.io/jvanz/policies/user-group-psp:latest</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">2022-03-29T17:34:37.847169Z  INFO kwctl::verify: Policy successfully verified</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>While the previous example tests if the policy is signed by the given key,
the next one checks if a given policy came from the Kubewarden organization:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ cat kubewarden_signatures.yaml</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">allOf:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - kind: githubAction</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    owner: kubewarden</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kwctl verify --verification-config-path kubewarden_signatures.yaml ghcr.io/kubewarden/policies/user-group-psp:latest</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">2022-03-29T18:07:39.062292Z  INFO kwctl::verify: Policy successfully verified</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/kubewarden/docs/edit/main/docs/distributing-policies/secure-supply-chain.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_eYIM" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vbeJ"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2022-07-20T08:10:59.000Z">7/20/2022</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/distributing-policies/oci-registries-support"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">OCI Registries Support</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/testing-policies/intro"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Testing Policies</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#signing-policies" class="table-of-contents__link toc-highlight">Signing policies</a><ul><li><a href="#keyless-signing" class="table-of-contents__link toc-highlight">Keyless signing</a></li><li><a href="#how-to-sign-artefacts-in-github-workflows" class="table-of-contents__link toc-highlight">How to sign artefacts in GitHub workflows</a></li></ul></li><li><a href="#listing-policy-signatures" class="table-of-contents__link toc-highlight">Listing policy signatures</a></li><li><a href="#verifying-policies" class="table-of-contents__link toc-highlight">Verifying policies</a></li><li><a href="#configuring-the-policy-server-to-check-policy-signatures" class="table-of-contents__link toc-highlight">Configuring the policy server to check policy signatures</a></li><li><a href="#signature-config-reference" class="table-of-contents__link toc-highlight">Signature Config Reference</a><ul><li><a href="#signature-validation" class="table-of-contents__link toc-highlight">Signature validation</a></li><li><a href="#how-to-use-signature-verification-config-file-to-check-a-policy-oci-artefact" class="table-of-contents__link toc-highlight">How to use signature verification config file to check a policy OCI artefact</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Kubewarden Project Authors. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.1ebc047b.js"></script>
<script src="/assets/js/main.049cf7e1.js"></script>
</body>
</html>